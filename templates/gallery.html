<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery Page</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        /* New toggle box styles */
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        .filter-box {
            border: 2px solid #ccc;
            border-radius: 5px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .filter-box.active {
            border-color: #4CAF50;
        }

        .filter-box img {
            max-width: 40px;
            max-height: 40px;
            margin: 0 auto;
        }

        .filter-value {
            display: none;
            margin-top: 5px;
        }

        .active .filter-value {
            display: block;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="navbar">
            <a href="{{ url_for('index') }}">Home</a>
            <a href="gallery">Gallery</a>
            <a href="submit" target="_blank">Submit</a>
        </div>

        <div class="divider"></div>

        <!-- Model Select -->
        <fieldset>
            <legend>Model</legend>
            {{ form.model(class="form-control") }}
        </fieldset>

        <div class="divider"></div>

    <!-- LoRA Toggle Boxes -->
    <fieldset>
        <legend>LoRA</legend>
        <div class="filter-grid">
            <!-- DMD2 Box -->
            <div class="filter-box" data-lora="DMD2">
                <span class="lora-label">DMD2</span>
                <img src="/static/icons/dmd2.png" onerror="this.src='/static/icons/missing.png'">
                <div class="filter-value">
                    <input type="number" value="0.7" min="0" max="2" step="0.1"
                        data-lora-field="DMD2" class="value-input">
                </div>
            </div>

            <!-- LCM Box -->
            <div class="filter-box" data-lora="LCM">
                <span class="lora-label">LCM</span>
                <img src="/static/icons/lcm.png" onerror="this.src='/static/icons/missing.png'">
                <div class="filter-value">
                    <input type="number" value="0.7" min="0" max="2" step="0.1"
                        data-lora-field="LCM" class="value-input">
                </div>
            </div>

            <!-- Bold Outlines Box -->
            <div class="filter-box" data-lora="Bold Outlines">
                <span class="lora-label">Bold Outlines</span>
                <img src="/static/icons/bold.png" onerror="this.src='/static/icons/missing.png'">
                <div class="filter-value">
                    <input type="number" value="0.7" min="0" max="2" step="0.1"
                        data-lora-field="Bold Outlines" class="value-input">
                </div>
            </div>

            <!-- Vivid Edge Box -->
            <div class="filter-box" data-lora="Vivid Edge">
                <span class="lora-label">Vivid Edge</span>
                <img src="/static/icons/vivid-edge.png" onerror="this.src='/static/icons/missing.png'">
                <div class="filter-value">
                    <input type="number" value="0.7" min="0" max="2" step="0.1"
                        data-lora-field="Vivid Edge" class="value-input">
                </div>
            </div>

            <!-- Vivid Soft Box -->
            <div class="filter-box" data-lora="Vivid Soft">
                <span class="lora-label">Vivid Soft</span>
                <img src="/static/icons/vivid-soft.png" onerror="this.src='/static/icons/missing.png'">
                <div class="filter-value">
                    <input type="number" value="0.7" min="0" max="2" step="0.1"
                        data-lora-field="Vivid Soft" class="value-input">
                </div>
            </div>
        </div>
    </fieldset>

        <div class="divider"></div>

        <!-- Sampling Method -->
        <fieldset>
            <legend>Sampling</legend>
            <select id="sampling-method" class="form-control">
                <option value="any">Any</option>
                <option value="euler a">Euler A</option>
                <option value="euler">Euler</option>
                <option value="ddim">DDIM</option>
                <option value="lms">LMS</option>
            </select>
        </fieldset>
    </div>

    <div class="grid"><!-- Image containers will be inserted here --></div>

    <script>
        // Toggle box functionality
        document.querySelectorAll('.filter-box').forEach(box => {
            box.addEventListener('click', function() {
                this.classList.toggle('active');
                const input = this.querySelector('.value-input');
                input.value = this.classList.contains('active') ? '0.7' : '0';
                displayImages();
            });
        });

        // Value input changes
        document.querySelectorAll('.value-input').forEach(input => {
            input.addEventListener('change', displayImages);
        });

        // Simplified displayImages function
        function displayImages() {
            const activeLoras = {};
            document.querySelectorAll('.filter-box.active').forEach(box => {
                const loraType = box.dataset.lora;
                const value = parseFloat(box.querySelector('.value-input').value);
                activeLoras[loraType] = value;
            });

            const filters = {
                model: document.querySelector('#model-select').value,
                sampling: document.querySelector('#sampling-method').value,
                loras: activeLoras
            };

            // Filter and display images based on filters...
            // (Keep your existing image display logic, but use the new filters object)
        }

        // Initialize event listeners
        document.getElementById('model-select').addEventListener('change', displayImages);
        document.getElementById('sampling-method').addEventListener('change', displayImages);
        document.addEventListener('DOMContentLoaded', displayImages);
    </script>
</body>
</html>