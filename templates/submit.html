<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Processing Form</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/submit.css">
</head>
<body>
    {% from "_macros.html" import slider_field, lora_submit %}

    <form method="POST" action="{{ submit_url }}" target="_blank">
        {{ form.hidden_tag() }}

        <div class="image-preview">
            <img id="preview" src="">
        </div>

        <fieldset>
            <legend>Data Sets</legend>
            {{ form.data_sets(size=3, multiple=True) }}
        </fieldset>

        <fieldset>
            <legend>Basic Info</legend>
            {{ form.prompt.label }} {{ form.prompt() }}<br>
            {{ form.model.label }} {{ form.model() }}<br>
        </fieldset>

        <fieldset>
            <legend>Tags</legend>
            <div class="tag-container">
                <div class="tag-input">
                    <input type="text" id="tag-input" placeholder="Add a tag...">
                    <button type="button" id="add-tag">+</button>
                </div>
                <div class="tags-list" id="tags-list">
                    </div>
            </div>
        </fieldset>

        <fieldset class="lora-fieldset">
            <legend>LoRA
                <button type="button" id="add-lora" class="add-button">+ Add Custom LoRA</button>
            </legend>
            <div id="lora-container">
                {% for field in form.lora_fields %}
                    {{ lora_submit(field) }}
                {% endfor %}
                <div id="dynamic-lora-container"></div>
            </div>
        </fieldset>

        <fieldset class="sampling-parameters">
            <legend>Sampling</legend>
            {{ form.sampling_method.label }} {{ form.sampling_method() }}<br>
            {{ form.sampling_steps.label }} {{ form.sampling_steps() }}<br>
            {{ form.cfg_scale.label }} {{ form.cfg_scale() }}<br>
        </fieldset>

        <label for="image-url">Image URL:</label>
        <input type="url" id="image-url" name="url" value="{{ form.url.data | default('') }}" oninput="updatePreview(this.value)">

        <input type="hidden" name="lora_data" id="lora-data">
        {{ form.submit() }}
    </form>

    <script src="{{ url_for('static', filename='js/submit/img_preview.js') }}"></script>
    <script src="{{ url_for('static', filename='js/submit/tags.js') }}"></script>
    <script src="{{ url_for('static', filename='js/submit/lora.js') }}"></script>

    <script>
        const initialUrl = document.getElementById('image-url').value;
        if (initialUrl) {
            updatePreview(initialUrl);
        }
    </script>
</body>
</html>